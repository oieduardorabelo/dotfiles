#!/bin/bash
#
# Homebrew
#
# This installs some of the common dependencies needed (or at least desired)
# using Homebrew.
[[ "$(uname -s)" != "Darwin" ]] && exit 0

fail() {
  printf "\\r\\033[2K  [\\033[0;31mFAIL\\033[0m] %s\\n" "$1"
  echo ''
}

uninstallHomebrew() {
  # Uninstall Homebrew
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)"
}

installHomebrew() {
  # Install Homebrew
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

# Check for Homebrew
if test ! "$(which brew)"; then
  printf "  Would like to install Homebrew? [y/n] "
  read -r -e answer

  if [ "$answer" = "y" ]; then
    echo "  Installing Homebrew for you..."
    installHomebrew
  fi
else
  if test "$(which brew)"; then
    printf "  Would like to re-install Homebrew? [y/n] "
    read -r -e answer

    if [ "$answer" = "y" ]; then
      uninstallHomebrew
      installHomebrew
    fi
  fi
fi

if test "$(which brew)"; then
  printf "  Would like to update, upgrade and cleanup Homebrew? [y/n] "
  read -r -e answer

  if [ "$answer" = "y" ]; then
    printf "  \\nRunning 'brew update'...\\n\\n"
    brew update
    printf "  \\nRunning 'brew upgrade'...\\n\\n"
    brew upgrade
    printf "  \\nRunning 'brew cleanup'...\\n\\n"
    brew cleanup
    brew prune
  fi
fi

# common dependencies
if test "$(which brew)"; then
  echo -e "
    Common dependencies:

    ffmpeg, gifsicle, git, grc, bash-completion, m-cli, nvm,
    coreutils, diff-so-fancy, bash-git-prompt
  "
  printf "  Would like to install common dependencies? [y/n] "
  read -r -e answer

  if [ "$answer" = "y" ]; then
    brew install ffmpeg \
      gifsicle \
      git \
      grc \
      bash-completion \
      m-cli \
      nvm \
      coreutils \
      diff-so-fancy || true
  fi

  echo -e "
    Common cask dependencies:

    font-hack, itsycal, the-unarchiver, sublime-text, vlc, alfred,
    sizeup, 1password, dash, google-chrome, cleanmymac, sublime-text, visual-studio-code,
    qlcolorcode, qlstephen, qlmarkdown, quicklook-json, qlprettypatch, quicklook-csv,
    betterzipql, qlimagesize, webpquicklook, suspicious-package, quicklookase, qlvideo
  "
  printf "  Would like to install common dependencies? [y/n] "
  read -r -e answerCask

  if [ "$answerCask" = "y" ]; then
    brew cask install caskroom/fonts/font-hack \
      itsycal \
      the-unarchiver \
      sublime-text \
      vlc \
      alfred \
      sizeup \
      1password \
      dash \
      sublime-text \
      visual-studio-code \
      google-chrome \
      cleanmymac \
      qlcolorcode \
      qlstephen \
      qlmarkdown \
      quicklook-json \
      qlprettypatch \
      quicklook-csv \
      betterzipql \
      qlimagesize \
      webpquicklook \
      suspicious-package \
      quicklookase \
      qlvideo || true
  fi
fi
